<domain type='qemu'>
  <name>{{ .Name }}</name>
  <memory unit='MiB'>{{ .RAM }}</memory>
  <currentMemory unit='MiB'>{{ .RAM }}</currentMemory>
  <vcpu placement='static'>{{ .VCPUs }}</vcpu>
  <os>
    <type{{ if .VirtArch }} arch='{{ .VirtArch }}'{{ end }}{{ if .Machine }} machine='{{ .Machine }}'{{ end }}>hvm</type>
{{ if .KernelPath }}
    <kernel>{{ .KernelPath }}</kernel>
{{ end }}
{{ if .InitrdPath }}
    <initrd>{{ .InitrdPath }}</initrd>
{{ end }}
{{ if .KernelCmdline }}
    <cmdline>{{ .KernelCmdline }}</cmdline>
{{ end }}
{{ if not .KernelPath }}
    <boot dev='hd'/>
{{ end }}
  </os>
  <features>
    <acpi/>
    <apic/>
  </features>
  <clock offset='utc'/>
  <on_poweroff>destroy</on_poweroff>
  <on_reboot>restart</on_reboot>
  <on_crash>destroy</on_crash>
  <devices>
    <disk type='file' device='disk'>
      <driver name='qemu' type='qcow2'/>
      <source file='{{ .Overlay }}'/>
      <target dev='{{ .DiskTarget }}' bus='{{ .DiskBus }}'/>
    </disk>
{{ if .SetupDisk }}
    <disk type='file' device='cdrom'>
      <driver name='qemu' type='raw'/>
      <source file='{{ .SetupDisk.File }}'/>
      <target dev='{{ .SetupDisk.Target }}' bus='{{ .CDBus }}'/>
      <readonly/>
    </disk>
{{ end }}
{{ if .SampleDisk }}
    <disk type='file' device='cdrom'>
      <driver name='qemu' type='raw'/>
      <source file='{{ .SampleDisk.File }}'/>
      <target dev='{{ .SampleDisk.Target }}' bus='{{ .CDBus }}'/>
      <readonly/>
    </disk>
{{ end }}
{{ range .ExtraDisks }}
    <disk type='file' device='cdrom'>
      <driver name='qemu' type='raw'/>
      <source file='{{ .File }}'/>
      <target dev='{{ .Target }}' bus='{{ $.CDBus }}'/>
      <readonly/>
    </disk>
{{ end }}
    <interface type='network'>
      <source network='{{ .Network }}'/>
      <model type='{{ .NetworkModel }}'/>
    </interface>
    <console type='pty'>
      <target type='serial' port='0'/>
    </console>
    <serial type='pty'>
      <target port='0'/>
    </serial>
    <channel type='unix'>
      <target type='virtio' name='org.qemu.guest_agent.0'/>
    </channel>
    <rng model='virtio'>
      <backend model='random'>/dev/urandom</backend>
    </rng>
    <memballoon model='virtio'/>
  </devices>
</domain>
